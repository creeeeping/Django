{% extends 'todo/base.html' %}
{% block content %}
<div class="page">

<h1>{{ todo.title }}</h1>

<table style="width:100%; border-collapse:collapse;">
    <tr>
        <th style="text-align:left; padding:12px 0; width:120px;">설명</th>
        <td>{{ todo.description }}</td>
    </tr>

    <tr>
        <th style="padding:12px 0;">기간</th>
        <td>{{ todo.start_date }} ~ {{ todo.end_date }}</td>
    </tr>

    <tr>
        <th style="padding:12px 0;">상태</th>
        <td>
            {% if todo.is_completed %}
                <span style="color:#10b981; font-weight:600;">완료</span>
            {% else %}
                <span style="color:#ef4444; font-weight:600;">진행중</span>
            {% endif %}
        </td>
    </tr>

    <tr>
        <th style="padding:12px 0;">생성 시간</th>
        <td style="font-size:13px; color:#6b7280;">
            {{ todo.created_at|date:"Y-m-d H:i" }}
        </td>
    </tr>

    <tr>
        <th style="padding:12px 0;">수정 시간</th>
        <td style="font-size:13px; color:#6b7280;">
            {{ todo.modified_at|date:"Y-m-d H:i" }}
        </td>
    </tr>
</table>

<div style="margin-top:36px; display:flex; gap:12px;">

    <button onclick="location.href='{% url 'cbv_todo_update' todo.id %}'">
        수정
    </button>

    <form method="post" action="{% url 'cbv_todo_delete' todo.id %}">
        {% csrf_token %}
        <button type="submit" style="color:#ef4444; border-color:#ef4444;">
            삭제
        </button>
    </form>
</div>

</div>
<hr style="margin:40px 0;">

<h3>댓글</h3>

<form method="post" action="{% url 'cbv_comment_create' todo.id %}">
    {% csrf_token %}
    {{ comment_form.message }}
    <button type="submit">댓글 작성</button>
</form>

<ul style="margin-top:20px;">
{% for comment in comments %}
    <li style="margin-bottom:10px;">
        <strong>{{ comment.user.username }}</strong> :
        {{ comment.message }}
        <span style="font-size:12px; color:#6b7280;">
            ({{ comment.created_at|date:"Y-m-d H:i" }})
        </span>

        {% if comment.user == request.user %}
            <a href="{% url 'cbv_comment_update' comment.id %}">수정</a>
            <form method="post"
                action="{% url 'cbv_comment_delete' comment.id %}"
                style="display:inline;">
                {% csrf_token %}
                <button type="submit">삭제</button>
            </form>
        {% endif %}
    </li>
{% empty %}
    <li>댓글이 없습니다.</li>
{% endfor %}
</ul>

{% endblock %}
